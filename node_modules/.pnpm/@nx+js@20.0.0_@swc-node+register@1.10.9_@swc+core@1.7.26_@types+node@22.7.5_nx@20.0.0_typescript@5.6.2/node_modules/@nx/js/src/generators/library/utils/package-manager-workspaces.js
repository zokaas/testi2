"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getProjectPackageManagerWorkspaceStateWarningTask = getProjectPackageManagerWorkspaceStateWarningTask;
const devkit_1 = require("@nx/devkit");
const semver_1 = require("semver");
function getProjectPackageManagerWorkspaceStateWarningTask(projectPackageManagerWorkspaceState, workspaceRoot) {
    return () => {
        const packageManager = (0, devkit_1.detectPackageManager)(workspaceRoot);
        let packageManagerWorkspaceSetupDocs;
        if (packageManager === 'pnpm') {
            packageManagerWorkspaceSetupDocs =
                'https://pnpm.io/workspaces and https://pnpm.io/pnpm-workspace_yaml';
        }
        else if (packageManager === 'yarn') {
            const yarnVersion = (0, devkit_1.getPackageManagerVersion)(packageManager, workspaceRoot);
            if ((0, semver_1.lt)(yarnVersion, '2.0.0')) {
                packageManagerWorkspaceSetupDocs =
                    'https://classic.yarnpkg.com/lang/en/docs/workspaces/';
            }
            else {
                packageManagerWorkspaceSetupDocs =
                    'https://yarnpkg.com/features/workspaces';
            }
        }
        else if (packageManager === 'npm') {
            packageManagerWorkspaceSetupDocs =
                'https://docs.npmjs.com/cli/v10/using-npm/workspaces';
        }
        else if (packageManager === 'bun') {
            packageManagerWorkspaceSetupDocs =
                'https://bun.sh/docs/install/workspaces';
        }
        if (projectPackageManagerWorkspaceState === 'no-workspaces') {
            devkit_1.output.warn({
                title: `The package manager workspaces feature is not enabled in the workspace`,
                bodyLines: [
                    'You must enable the package manager workspaces feature to use the "@nx/js/typescript" plugin.',
                    `Read more about the ${packageManager} workspaces feature and how to set it up at ${packageManagerWorkspaceSetupDocs}.`,
                ],
            });
        }
        else if (projectPackageManagerWorkspaceState === 'excluded') {
            devkit_1.output.warn({
                title: `The project is not included in the package manager workspaces configuration`,
                bodyLines: [
                    'Please add it to the workspace configuration to use the "@nx/js/typescript" plugin.',
                    `Read more about the ${packageManager} workspaces feature and how to set it up at ${packageManagerWorkspaceSetupDocs}.`,
                ],
            });
        }
    };
}
